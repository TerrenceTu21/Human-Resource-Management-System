@model fyphrms.Models.Employees.AttendanceViewModel
@{
    ViewData["Title"] = "Employee Attendance Clock-in & Clock-out";
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
@Html.AntiForgeryToken()

<style>
    .clock-container {
        max-width: 600px;
        margin: 40px auto;
        padding: 30px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        text-align: center;
    }

    .clock-date {
        font-size: 1.25rem;
        color: #666;
        margin-bottom: 5px;
    }

    .clock-time {
        font-size: 3.5rem;
        font-weight: 700;
        margin-bottom: 30px;
    }

    .clock-buttons {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 40px;
    }

    .clock-btn {
        padding: 15px 30px;
        font-size: 1.1rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        gap: 8px;
    }

    #clock-in-btn {
        background: #4CAF50;
        color: white;
    }

    #clock-out-btn {
        background: #f44336;
        color: white;
    }

    .clock-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
    }

    .last-entry-box {
        background: #f7f7f7;
        padding: 20px;
        border-radius: 8px;
        display: flex;
        justify-content: space-around;
    }

    .last-entry-label {
        font-weight: 600;
        margin-bottom: 5px;
    }

    #status-message {
        margin-top: -10px;
        margin-bottom: 20px;
        font-weight: 500;
    }
</style>

<div class="clock-container">
    <h2>Clock-In & Clock-Out</h2>

    <div class="clock-display">
        <div id="current-date" class="clock-date"></div>
        <div id="current-time" class="clock-time"></div>
    </div>

    <p id="status-message">
        @if (Model.IsClockedIn)
        {
            <span class="text-green-600">You are currently clocked in.</span>
        }
        else
        {
            <span class="text-gray-600">Ready to start your shift.</span>
        }
    </p>

    <div class="clock-buttons">
        <a id="clock-in-btn" class="clock-btn"
           href="@Url.Action("EmployeeFaceRecognition", "Employee")"
           style="display:@(Model.IsClockedIn ? "none" : "flex");">

            <i class="fas fa-camera"></i> Clock In
        </a>

        <button id="clock-out-btn" class="clock-btn"
                onclick="window.location.href='@Url.Action("EmployeeFaceRecognition", "Employee")?mode=ClockOut'"
                style="display:@(Model.IsClockedIn ? "flex" : "none");">
            <i class="far fa-clock"></i> Clock Out
        </button>

    </div>

    <div class="last-entry-box">
        <div>
            <div class="last-entry-label">Last Clock In:</div>
            <div id="last-clock-in">
                @(Model.LastClockIn.HasValue? Model.LastClockIn.Value.ToLocalTime().ToString("HH:mm dd/MM/yyyy") : "Not Available")
            </div>
        </div>
        <div>
            <div class="last-entry-label">Last Clock Out:</div>
            <div id="last-clock-out">
                @(Model.LastClockOut.HasValue? Model.LastClockOut.Value.ToLocalTime().ToString("HH:mm dd/MM/yyyy") : "Not Available")
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        
        function updateClock() {
            const now = new Date();
            document.getElementById("current-date").textContent =
                now.toLocaleDateString(undefined, { weekday: "long", year: "numeric", month: "long", day: "numeric" });

            document.getElementById("current-time").textContent =
                now.toLocaleTimeString(undefined, { hour: "numeric", minute: "2-digit", second: "2-digit", hour12: true });
        }
        updateClock();
        setInterval(updateClock, 1000);



        
        const clockOutBtn = document.getElementById("clock-out-btn");
        const clockInBtn = document.getElementById("clock-in-btn");
        const lastClockInEl = document.getElementById("last-clock-in");
        const lastClockOutEl = document.getElementById("last-clock-out");
        const statusMessage = document.getElementById("status-message");

        function updateUI(isClockedIn) {
            if (isClockedIn) {
                clockInBtn.style.display = "none";
                clockOutBtn.style.display = "flex";
                clockOutBtn.disabled = false;
                statusMessage.innerHTML = "<span class='text-green-600'>You are currently clocked in.</span>";
            } else {
                clockInBtn.style.display = "flex";
                clockOutBtn.style.display = "none";
                statusMessage.innerHTML = "<span class='text-gray-600'>Ready to start your shift.</span>";
            }
        }



        

        // Initial UI from ViewModel
        updateUI(@Model.IsClockedIn.ToString().ToLower());
    </script>
}
